---
title: "send_email_oncology"
output: html_document
date: "2023-07-27"
---

```{r setup, include=FALSE}
library(blastula)
library(rmarkdown)
library(here)
library(glue)
```


```{r pressure, echo=FALSE}
email_credential_location <- "/SharedDrive/deans/Presidents/HSPI-PM/Operations Analytics and Optimization/Administrative/Workgroups/R Workbench/Working Area/Data Connections/email_creds"
send_list <- c("armando.villegas@mssm.edu")
email_subject <- "Oncology Monthly Data Pull"

##run monthly processing
source("Scripts/pull_and_process_monthly.R")

##Use blastula to construct email to send

compose_email(
  body = md(glue("
  Hello,
  
  Please find the Oncology data for {min_date}-{max_date} attached.
    
    -Armando"
  )
  ),
  footer = md(glue("This is an automated email."))
) %>%
  add_attachment(
    file = save_compressed_file_path,
    filename = paste0("Oncology Data ", month_year, ".zip")
  ) %>%
  smtp_send(
    from = "armando.villegas@mssm.edu",
    to = send_list,
    credentials = creds_file(file = email_credential_location),
    subject = email_subject
  )
```

